<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>SDK: CommaSeparatedValuesWriterDemo.cpp</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../ibeo_logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK
   &#160;<span id="projectnumber">6.0.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Home</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dd/d32/a00041.html"><span>Data&#160;Types</span></a></li>
      <li><a href="../../d5/db6/a00042.html"><span>Examples</span></a></li>
      <li><a href="../../d3/dea/a00046.html"><span>Changelog</span></a></li>
      <li><a href="../../d3/de7/a00039.html"><span>License</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CommaSeparatedValuesWriterDemo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Demo project reading an idc file and writing some of the data to comma separated values.</p>
<div class="fragment"><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment"></span><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../da/d71/a00814.html">ibeo/common/sdk/listener/DataContainerListener.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/df5/a01395.html">ibeo/common/sdk/datablocks/scan/special/Scan2209.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d88/a00962.html">ibeo/common/sdk/devices/IdcFile.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/db0/a00945.html">ibeo/common/sdk/IbeoSdk.hpp</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;boost/program_options.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;boost/asio.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d0/dd3/a01077.html">ibeo::common::sdk</a>;</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> std::string <a name="a0"></a><a class="code" href="../../d1/d7c/a00003.html#a3c9f34bd2e11a5d854fc61609b3edb3b">appName</a> = <span class="stringliteral">&quot;IbeoSdkCommaSeparatedValuesWriterDemo&quot;</span>;</div><div class="line"><a name="_a1"></a><a class="code" href="../../d0/def/a00256.html">IbeoSdk</a> <a name="a2"></a><a class="code" href="../../d1/d7c/a00003.html#abda0089baed0762b7de3aec2a584f774">ibeoSdk</a>;</div><div class="line">ibeo::common::logging::LoggerSPtr <a name="a3"></a><a class="code" href="../../d1/d7c/a00003.html#aa7780ecde975d91b7cbb3d89207ddcf5">appLogger</a> = ibeo::common::logging::LogManager::getInstance().createLogger(<a class="code" href="../../d1/d7c/a00003.html#a3c9f34bd2e11a5d854fc61609b3edb3b">appName</a>);</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment"></span><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">class </span>CsvWriter</div><div class="line">{</div><div class="line">    constexpr <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* colSeparator = <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ~CsvWriter()</div><div class="line">    {</div><div class="line">        m_file.flush();</div><div class="line">        m_file.close();</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//========================================</span></div><div class="line"><span class="comment"></span>    <span class="comment">//----------------------------------------</span></div><div class="line">    <span class="keywordtype">bool</span> create(<span class="keyword">const</span> std::string&amp; filename)</div><div class="line">    {</div><div class="line">        m_file.open(filename);</div><div class="line">        <span class="keywordflow">return</span> m_file.is_open();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//========================================</span></div><div class="line"><span class="comment"></span>    <span class="comment">//----------------------------------------</span></div><div class="line">    <span class="keywordtype">bool</span> isOpen() { <span class="keywordflow">return</span> m_file.is_open(); }</div><div class="line"></div><div class="line">    <span class="comment">//========================================</span></div><div class="line"><span class="comment"></span>    <span class="comment">//----------------------------------------</span></div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line">    CsvWriter&amp; <a name="a4"></a><a class="code" href="../../d0/dd3/a01077.html#aae9e695c2e9ecd51fa10556bd7fe3f1c">operator&lt;&lt;</a>(<span class="keyword">const</span> T&amp; value)</div><div class="line">    {</div><div class="line">        m_file &lt;&lt; value &lt;&lt; colSeparator;</div><div class="line">        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//========================================</span></div><div class="line"><span class="comment"></span>    <span class="comment">//----------------------------------------</span></div><div class="line">    <span class="keywordtype">void</span> endl()</div><div class="line">    {</div><div class="line">        m_file &lt;&lt; std::endl;</div><div class="line">        m_file.flush();</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    std::ofstream m_file;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment"></span><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">template</span>&lt;&gt;</div><div class="line">CsvWriter&amp; <a class="code" href="../../d0/dd3/a01077.html#aae9e695c2e9ecd51fa10556bd7fe3f1c">CsvWriter::operator&lt;&lt;</a>(<span class="keyword">const</span> uint8_t&amp; value)</div><div class="line">{</div><div class="line">    m_file &lt;&lt; static_cast&lt;int&gt;(value) &lt;&lt; colSeparator;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment"></span><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">class </span>ScanListener : <span class="keyword">public</span> <a name="_a5"></a><a class="code" href="../../d8/d87/a00118.html">ibeo::common::sdk::DataContainerListener</a>&lt;Scan2209, DataTypeId::DataType_Scan2209&gt;,</div><div class="line">                     <span class="keyword">public</span> CsvWriter</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ~ScanListener() <span class="keyword">override</span> = <span class="keywordflow">default</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//========================================</span></div><div class="line"><span class="comment"></span>    <span class="comment">//----------------------------------------</span></div><div class="line">    <span class="keywordtype">void</span> onData(<span class="keyword">const</span> <a name="_a6"></a><a class="code" href="../../d7/db7/a00525.html">Scan2209</a>&amp; scan)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        *<span class="keyword">this</span> &lt;&lt; scan.<a name="a7"></a><a class="code" href="../../d7/db7/a00525.html#a42e58818735609b4f71cf84c09b1c15e">getScanNumber</a>() &lt;&lt; scan.<a name="a8"></a><a class="code" href="../../d7/db7/a00525.html#a6af74f3003034458b5bfafc9800cbb8a">getStartTimestamp</a>() &lt;&lt; scan.<a name="a9"></a><a class="code" href="../../d7/db7/a00525.html#a0404ad179b8f4bbddc0d4ce0ebbf99b3">getEndTimeOffset</a>()</div><div class="line">              &lt;&lt; scan.<a name="a10"></a><a class="code" href="../../d7/db7/a00525.html#ab958d6457cb50369584df2ab34cfd021">getNumberOfScanPoints</a>();</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pt : scan.<a name="a11"></a><a class="code" href="../../d7/db7/a00525.html#ad65b7d1ddc566e4df11b4658eb6c7ff7">getScanPoints</a>())</div><div class="line">        {</div><div class="line">            *<span class="keyword">this</span> &lt;&lt; pt.getDeviceId() &lt;&lt; pt.getEchoPulseWidth() &lt;&lt; pt.getPositionX() &lt;&lt; pt.getPositionY()</div><div class="line">                  &lt;&lt; pt.getPositionZ();</div><div class="line">        }</div><div class="line"></div><div class="line">        endl();</div><div class="line">    }</div><div class="line">}; <span class="comment">// ScanListener</span></div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a12"></a><a class="code" href="../../d1/d7c/a00003.html#af2d793a280c4845d03975d497f5d17a1">csvWriterFile</a>(<span class="keyword">const</span> std::string&amp; inFilename, <span class="keyword">const</span> std::string&amp; outFilename);</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment"></span><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">class </span>CommandLineArguments</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    CommandLineArguments(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>** argv)</div><div class="line">    {</div><div class="line">        <span class="keyword">using namespace </span>boost::program_options;</div><div class="line">        variables_map cmdVars;</div><div class="line"></div><div class="line">        options_description desc(<a class="code" href="../../d1/d7c/a00003.html#a3c9f34bd2e11a5d854fc61609b3edb3b">appName</a>);</div><div class="line">        desc.add_options() <span class="comment">//</span></div><div class="line">            (<span class="stringliteral">&quot;input,i&quot;</span>, value&lt;std::string&gt;(&amp;m_inputFileName)-&gt;required(), <span class="stringliteral">&quot;Name of the input IDC file&quot;</span>) <span class="comment">//</span></div><div class="line">            (<span class="stringliteral">&quot;output,o&quot;</span>, value&lt;std::string&gt;(&amp;m_outputFileName)-&gt;required(), <span class="stringliteral">&quot;Name of the output file.&quot;</span>) <span class="comment">//</span></div><div class="line">            (<span class="stringliteral">&quot;help,h&quot;</span>, <span class="stringliteral">&quot;Show this message&quot;</span>);</div><div class="line">        positional_options_description pos_opts;</div><div class="line">        pos_opts.add(<span class="stringliteral">&quot;input&quot;</span>, 1);</div><div class="line"></div><div class="line">        <span class="keywordflow">try</span></div><div class="line">        {</div><div class="line">            store(command_line_parser(argc, argv).options(desc).positional(pos_opts).run(), cmdVars);</div><div class="line">            notify(cmdVars);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (<span class="keyword">const</span> boost::program_options::multiple_occurrences&amp; e)</div><div class="line">        {</div><div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;*** Error in command line arguments: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">            desc.print(std::cerr);</div><div class="line">            exit(1);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (<span class="keyword">const</span> boost::program_options::error&amp; e)</div><div class="line">        {</div><div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;*** Error in command line arguments: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">            desc.print(std::cerr);</div><div class="line">            exit(1);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (cmdVars.count(<span class="stringliteral">&quot;help&quot;</span>))</div><div class="line">        {</div><div class="line">            desc.print(std::cerr);</div><div class="line">            exit(0);</div><div class="line">        }</div><div class="line"></div><div class="line">        <a name="_a13"></a><a class="code" href="../../d1/dd4/a00267.html">IdcFile</a> testFile;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (!testFile.<a name="a14"></a><a class="code" href="../../d1/dd4/a00267.html#abf1a867471a14868c239bf19d67d8233">open</a>(m_inputFileName))</div><div class="line">        {</div><div class="line">            std::cerr &lt;&lt; (<span class="stringliteral">&quot;Couldn&#39;t open IDC file!&quot;</span>);</div><div class="line">            exit(1);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">const</span> std::string&amp; getInputFileName()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_inputFileName; }</div><div class="line">    <span class="keyword">const</span> std::string&amp; getOutputFileName()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_outputFileName; }</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    std::string m_inputFileName{};</div><div class="line">    std::string m_outputFileName{};</div><div class="line">}; <span class="comment">// CommandLineArguments</span></div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a15"></a><a class="code" href="../../d1/d7c/a00003.html#ac762d48b889bd832ec0d42abcbc50624">main</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    std::cerr &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="../../d1/d7c/a00003.html#a3c9f34bd2e11a5d854fc61609b3edb3b">appName</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div><div class="line">              &lt;&lt; <span class="stringliteral">&quot; using IbeoSDK &quot;</span> &lt;&lt; ibeoSdk.<a name="a16"></a><a class="code" href="../../d0/def/a00256.html#a72cbe7aab34d9777ef1c245937c492ac">getVersion</a>().<a name="a17"></a><a class="code" href="../../db/ddc/a00636.html#a89861cb09d4712e2fe3de28f3b2de8e4">toString</a>() &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    CommandLineArguments cmdargs(argc, argv);</div><div class="line"></div><div class="line">    ibeo::common::logging::LogManager::getInstance().setDefaultLogLevel(<span class="stringliteral">&quot;Debug&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// start the csv export</span></div><div class="line">    <a class="code" href="../../d1/d7c/a00003.html#af2d793a280c4845d03975d497f5d17a1">csvWriterFile</a>(cmdargs.getInputFileName(), cmdargs.getOutputFileName());</div><div class="line"></div><div class="line">    exit(0);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div><div class="line"></div><div class="line"><span class="comment">// demo loop dumping Scan2209 scans to a csv file</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="../../d1/d7c/a00003.html#af2d793a280c4845d03975d497f5d17a1">csvWriterFile</a>(<span class="keyword">const</span> std::string&amp; inFilename, <span class="keyword">const</span> std::string&amp; outFilename)</div><div class="line">{</div><div class="line">    ScanListener scanListenerCsv;</div><div class="line"></div><div class="line">    scanListenerCsv.create(outFilename);</div><div class="line">    <span class="keywordflow">if</span> (!scanListenerCsv.isOpen())</div><div class="line">    {</div><div class="line">        LOGERROR(<a class="code" href="../../d1/d7c/a00003.html#aa7780ecde975d91b7cbb3d89207ddcf5">appLogger</a>, <span class="stringliteral">&quot;Output file not open!&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="../../d1/dd4/a00267.html">IdcFile</a> file;</div><div class="line">    file.<a class="code" href="../../d1/dd4/a00267.html#abf1a867471a14868c239bf19d67d8233">open</a>(inFilename);</div><div class="line">    <span class="keywordflow">if</span> (file.<a name="a18"></a><a class="code" href="../../d1/dd4/a00267.html#abc9fa029d970922fecf86b51c56a750b">isOpen</a>())</div><div class="line">    {</div><div class="line">        file.<a name="a19"></a><a class="code" href="../../d1/dd4/a00267.html#a9eeb06d9a3bd1b1d59232dd2031538d6">registerContainerListener</a>(&amp;scanListenerCsv);</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span> (file.<a name="a20"></a><a class="code" href="../../d1/dd4/a00267.html#adf59d800486b7461a96f77714bb7cf76">isGood</a>())</div><div class="line">        {</div><div class="line">            <span class="keyword">const</span> <a class="code" href="../../d1/dd4/a00267.html#a995ee789daa97a217c4884e51bb09820">IdcFile::ContainerImporterPairs</a> p = file.<a name="a21"></a><a class="code" href="../../d1/dd4/a00267.html#a69e25a1d17b5b61c66685e0ebc86586d">getNextDataContainer</a>();</div><div class="line">            file.<a name="a22"></a><a class="code" href="../../d1/dd4/a00267.html#a52f14922c975c0ff6d9d10166ac711bb">notifyContainerListeners</a>(p);</div><div class="line"></div><div class="line">            std::this_thread::yield();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//==============================================================================</span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 17 2020 15:12:29 for SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
